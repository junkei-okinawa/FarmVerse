# CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

FarmVerseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®GitHub Actions CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

---

## ğŸ“‹ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§

### 1. Host Unit Tests (`unit_tests.yml`)

**ãƒˆãƒªã‚¬ãƒ¼:**
- `push`: main, develop, feature/* ãƒ–ãƒ©ãƒ³ãƒ
- `pull_request`: main, develop ãƒ–ãƒ©ãƒ³ãƒ
- `workflow_dispatch`: æ‰‹å‹•å®Ÿè¡Œ

**å®Ÿè¡Œå†…å®¹:**
- ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã§ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€Clippyï¼‰
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

**å®Ÿè¡Œæ™‚é–“:** ç´„2-3åˆ†

**ã‚¸ãƒ§ãƒ–:**
1. `unit-test` - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
2. `code-quality` - ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

---

### 2. Test Coverage Report (`test_coverage.yml`)

**ãƒˆãƒªã‚¬ãƒ¼:**
- `push`: main ãƒ–ãƒ©ãƒ³ãƒ
- `schedule`: æ¯é€±æ—¥æ›œæ—¥ 00:00 UTC
- `workflow_dispatch`: æ‰‹å‹•å®Ÿè¡Œ

**å®Ÿè¡Œå†…å®¹:**
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- ãƒãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
- PRã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ï¼ˆPRæ™‚ï¼‰

**å®Ÿè¡Œæ™‚é–“:** ç´„2-3åˆ†

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
cd devices/xiao_esp32s3_sense
./run_tests.sh
```

### GitHub Actionsã§ã®æ‰‹å‹•å®Ÿè¡Œ

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã®ã€ŒActionsã€ã‚¿ãƒ–ã«ç§»å‹•
2. å®Ÿè¡Œã—ãŸã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠ
3. ã€ŒRun workflowã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ–ãƒ©ãƒ³ãƒã‚’é¸æŠã—ã¦å®Ÿè¡Œ

---

## ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸

ä»¥ä¸‹ã‚’README.mdã«è¿½åŠ ã§ãã¾ã™ï¼š

```markdown
![Unit Tests](https://github.com/junkei-okinawa/FarmVerse/actions/workflows/unit_tests.yml/badge.svg)
![Coverage](https://img.shields.io/badge/tests-23%20passing-brightgreen)
```

---

## ğŸ”§ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è©³ç´°

### unit_tests.yml

```yaml
jobs:
  unit-test:
    runs-on: macos-latest
    steps:
      - Checkout
      - Setup Rust
      - Run unit tests
      - Check test results
      - Upload artifacts
      
  code-quality:
    runs-on: macos-latest
    steps:
      - Checkout
      - Setup Rust
      - Check formatting
      - Run Clippy
      - Generate summary
```

### ãƒ‘ã‚¹ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã®ã¿å®Ÿè¡Œ:
- `devices/xiao_esp32s3_sense/src/**`
- `devices/xiao_esp32s3_sense/run_tests.sh`
- `.github/workflows/unit_tests.yml`

---

## ğŸ“ˆ ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ç¾åœ¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸

| Component | Tests | Coverage |
|-----------|-------|----------|
| Voltage Calculation | 10 | 95%+ |
| MAC Address | 13 | 95%+ |
| **Total** | **23** | **95%+** |

### ç›®æ¨™

- Phase 1: âœ… 23 tests (å®Œäº†)
- Phase 2: ğŸ¯ 40+ tests (è¨ˆç”»ä¸­)
- Phase 3: ğŸ¯ 60+ tests (è¨ˆç”»ä¸­)

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã™ã‚‹

1. **ãƒ†ã‚¹ãƒˆå¤±æ•—:**
   - ãƒ­ãƒ¼ã‚«ãƒ«ã§ `./run_tests.sh` ã‚’å®Ÿè¡Œ
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
   - ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦ã‚³ãƒŸãƒƒãƒˆ

2. **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼:**
   ```bash
   cd devices/xiao_esp32s3_sense
   cargo fmt
   ```

3. **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—:**
   - ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã—ãŸã‹ç¢ºèª
   - `target/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œãªã„

1. **ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç¢ºèª:**
   - å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹
   
2. **ãƒ–ãƒ©ãƒ³ãƒç¢ºèª:**
   - ãƒˆãƒªã‚¬ãƒ¼å¯¾è±¡ã®ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ã„ã‚‹ã‹

---

## ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å¤‰æ›´

```yaml
- name: Run unit tests
  timeout-minutes: 10  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç„¡åˆ¶é™
  run: |
    cd devices/xiao_esp32s3_sense
    ./run_tests.sh
```

### ç•°ãªã‚‹OSã§ã®å®Ÿè¡Œ

```yaml
strategy:
  matrix:
    os: [ubuntu-latest, macos-latest, windows-latest]
runs-on: ${{ matrix.os }}
```

### ä¸¦åˆ—å®Ÿè¡Œ

ç¾åœ¨ã¯2ã¤ã®ã‚¸ãƒ§ãƒ–ãŒä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã¾ã™:
- `unit-test`
- `code-quality`

---

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **é »ç¹ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ:** ãƒ—ãƒƒã‚·ãƒ¥å‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆ
2. **å°ã•ãªã‚³ãƒŸãƒƒãƒˆ:** å¤‰æ›´ã‚’ç´°ã‹ãã‚³ãƒŸãƒƒãƒˆ
3. **æ„å‘³ã®ã‚ã‚‹ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:** å¤‰æ›´å†…å®¹ã‚’æ˜ç¢ºã«
4. **ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ :** æ–°æ©Ÿèƒ½ã«ã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
5. **ãƒ¬ãƒ“ãƒ¥ãƒ¼:** PRã¯å¿…ãšãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã‚‹

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [HOST_UNIT_TESTS.md](../devices/xiao_esp32s3_sense/HOST_UNIT_TESTS.md) - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [TESTING_DOCS.md](../devices/xiao_esp32s3_sense/TESTING_DOCS.md) - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- [tests/docs/](../devices/xiao_esp32s3_sense/tests/docs/) - è©³ç´°èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

---

**æœ€çµ‚æ›´æ–°:** 2025-11-02  
**ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼:** junkei-okinawa
