# バッテリー駆動問題解決: 最適化レポート

XIAO ESP32S3 Senseにおけるバッテリー駆動時のリセットループ問題（Brownout）に対し、多角的な省電力対策を実施しました。
最終的に、**ハードウェア的な電圧確保とソフトウェア的な電力削減策の組み合わせ**により、安定動作を実現しました。

## 実装済みの省電力設定（推奨）

以下の設定は、バッテリー駆動の安定性と効率を最大化するために**維持することを強く推奨**します。

### 1. CPU周波数の削減 (240MHz → 80MHz)
- **設定**: `sdkconfig.defaults` -> `CONFIG_ESP32S3_DEFAULT_CPU_FREQ_MHZ=80`
- **理由**: ベース消費電流を大幅に削減（推定30-50mA減）。処理速度より安定性を優先。

### 2. WiFi送信パワー削減 (20dBm → 8dBm)
- **設定**: `cfg.toml` -> `wifi_tx_power_dbm = 8`
- **理由**: 送信時のピーク電流（突入電流）を抑制し、電圧降下を防ぐ。

### 3. 突入電流分散シーケンス
- **設定**: `src/communication/network_manager.rs`
- **理由**: WiFi初期化の各段階（ドライバ起動、RF起動、送信開始）に意図的に遅延を入れ、電流スパイクを分散。

---

## 最低駆動電圧に関する調査

本システムの安定稼働に必要な最低バッテリー電圧についての調査記録です。

### 測定結果

| バッテリー電圧 | 挙動 | 結果 | 備考 |
|---|---|---|---|
| **3.5V** | 起動失敗またはリセットループ | ❌ | LDOドロップアウト発生 |
| **3.?V** | WiFi初期化失敗 | ❌ | - |
| **3.8V** | 正常起動 → 撮影 → 送信 → DeepSleep | ✅ | 安定稼働ライン（暫定） |
| **[調査予定]** | | | |
| **[調査予定]** | | | |

> **追記**: ここに詳細な電圧と挙動の調査結果を追記してください。

---
**作成日**: 2026-01-25
