# âœ… CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†

GitHub Actions ã«ã‚ˆã‚‹ãƒ›ã‚¹ãƒˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–

---

## ğŸ“ ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

```
FarmVerse/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ unit_tests.yml          # ãƒ¡ã‚¤ãƒ³ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”‚   â”‚   â””â”€â”€ test_coverage.yml       # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”‚   â””â”€â”€ CICD_README.md              # CI/CDãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚
â””â”€â”€ devices/xiao_esp32s3_sense/
    â”œâ”€â”€ run_tests.sh                # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â””â”€â”€ HOST_UNIT_TESTS.md          # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

---

## ğŸš€ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¦‚è¦

### 1. Host Unit Tests (`unit_tests.yml`)

**è‡ªå‹•å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:**
- âœ… `push` - main, develop, feature/* ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æ™‚
- âœ… `pull_request` - main, develop ãƒ–ãƒ©ãƒ³ãƒã¸ã®PRä½œæˆæ™‚
- âœ… æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

**å®Ÿè¡Œå†…å®¹:**
```yaml
jobs:
  unit-test:          # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
  code-quality:       # ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
```

**æ‰€è¦æ™‚é–“:** ç´„2-3åˆ†

---

### 2. Test Coverage Report (`test_coverage.yml`)

**è‡ªå‹•å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:**
- âœ… `push` - main ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æ™‚
- âœ… `schedule` - æ¯é€±æ—¥æ›œæ—¥ 00:00 UTC
- âœ… æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

**å®Ÿè¡Œå†…å®¹:**
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
- ãƒãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ

---

## ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã®ä½¿ç”¨æ–¹æ³•

### README.mdã«è¿½åŠ 

```markdown
# FarmVerse

![Unit Tests](https://github.com/junkei-okinawa/FarmVerse/actions/workflows/unit_tests.yml/badge.svg)
![Test Coverage](https://img.shields.io/badge/tests-23%20passing-brightgreen)
![Rust](https://img.shields.io/badge/rust-stable-orange)

ESP32-S3 IoTãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
```

### è¡¨ç¤ºä¾‹

![Unit Tests](https://github.com/junkei-okinawa/FarmVerse/actions/workflows/unit_tests.yml/badge.svg)
![Test Coverage](https://img.shields.io/badge/tests-23%20passing-brightgreen)

---

## ğŸ”§ ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰
cd devices/xiao_esp32s3_sense

# ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
./run_tests.sh
```

**å‡ºåŠ›ä¾‹:**
```
================================
ãƒ›ã‚¹ãƒˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
================================

ğŸ§ª é›»åœ§è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ...
running 10 tests
test result: ok. 10 passed; 0 failed

ğŸ§ª MACã‚¢ãƒ‰ãƒ¬ã‚¹å‡¦ç†ã®ãƒ†ã‚¹ãƒˆ...
running 13 tests
test result: ok. 13 passed; 0 failed

================================
âœ… ãƒ†ã‚¹ãƒˆå®Œäº†
================================
```

---

## ğŸ“ˆ ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

| Component | Tests | Coverage | Status |
|-----------|-------|----------|--------|
| Voltage Calculation | 10 | 95%+ | âœ… |
| MAC Address | 13 | 95%+ | âœ… |
| **Total** | **23** | **95%+** | âœ… |

---

## ğŸ¯ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å‹•ä½œç¢ºèª

### Step 1: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ

```bash
git add .github/workflows/
git add devices/xiao_esp32s3_sense/run_tests.sh
git commit -m "Add CI/CD pipeline for host unit tests"
git push origin main
```

### Step 2: GitHub Actionsã§ç¢ºèª

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã«ç§»å‹•
2. ã€ŒActionsã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€ŒHost Unit Testsã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèª
4. å®Ÿè¡Œçµæœã‚’ç¢ºèª

### Step 3: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã®ç¢ºèª

- README.mdã®ãƒãƒƒã‚¸ãŒæ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- ã‚°ãƒªãƒ¼ãƒ³ãƒãƒƒã‚¸ âœ… = ãƒ†ã‚¹ãƒˆæˆåŠŸ
- ãƒ¬ãƒƒãƒ‰ãƒãƒƒã‚¸ âŒ = ãƒ†ã‚¹ãƒˆå¤±æ•—

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œãªã„å ´åˆ

1. **ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç¢ºèª:**
   ```yaml
   paths:
     - 'devices/xiao_esp32s3_sense/src/**'
     - 'devices/xiao_esp32s3_sense/run_tests.sh'
   ```
   ä¸Šè¨˜ã®ãƒ‘ã‚¹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ

2. **ãƒ–ãƒ©ãƒ³ãƒç¢ºèª:**
   - main, develop, feature/* ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ

3. **æ¨©é™ç¢ºèª:**
   - ãƒªãƒã‚¸ãƒˆãƒªã®Actionsè¨­å®šãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã‹ï¼Ÿ

### ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹å ´åˆ

1. **ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ:**
   ```bash
   ./run_tests.sh
   ```

2. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª:**
   - GitHub Actionsã®Logã‚’ç¢ºèª
   - å¤±æ•—ã—ãŸã‚¹ãƒ†ãƒƒãƒ—ã‚’ç‰¹å®š

3. **ä¿®æ­£ã—ã¦ãƒªãƒˆãƒ©ã‚¤:**
   ```bash
   # ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£
   git add .
   git commit -m "Fix test failure"
   git push
   ```

---

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[.github/CICD_README.md](./.github/CICD_README.md)** - CI/CDå®Œå…¨ã‚¬ã‚¤ãƒ‰
- **[devices/xiao_esp32s3_sense/HOST_UNIT_TESTS.md](./devices/xiao_esp32s3_sense/HOST_UNIT_TESTS.md)** - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **[devices/xiao_esp32s3_sense/TESTING_DOCS.md](./devices/xiao_esp32s3_sense/TESTING_DOCS.md)** - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥æ¦‚è¦

### è©³ç´°èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

- **tests/docs/00_README.md** - ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- **tests/docs/01_SUMMARY.md** - èª¿æŸ»ã‚µãƒãƒªãƒ¼
- **tests/docs/02_STRATEGY.md** - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- **tests/docs/03_INVESTIGATION_REPORT.md** - è©³ç´°èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ
- **tests/docs/04_PROBE_RS_SETUP_GUIDE.md** - probe-rsã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå°†æ¥ç”¨ï¼‰

---

## ğŸ‰ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 2: ãƒ†ã‚¹ãƒˆæ‹¡å……

- [ ] `MeasuredData`ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 
- [ ] ESP-NOWãƒ•ãƒ¬ãƒ¼ãƒ æ§‹ç¯‰ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 
- [ ] è¨­å®šãƒ‘ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

### Phase 3: å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ (probe-rs)

- [ ] probe-rsç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ
- [ ] Self-hosted runneræ§‹ç¯‰

### Phase 4: ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š

- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸50%é”æˆ
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- [ ] PRã¸ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚³ãƒ¡ãƒ³ãƒˆè‡ªå‹•æŠ•ç¨¿

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

è¨­å®šå®Œäº†ã®ç¢ºèª:

- [x] `.github/workflows/unit_tests.yml` ä½œæˆ
- [x] `.github/workflows/test_coverage.yml` ä½œæˆ
- [x] `.github/CICD_README.md` ä½œæˆ
- [x] `run_tests.sh` å®Ÿè¡Œå¯èƒ½
- [x] ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
- [ ] GitHub Actionsã§å‹•ä½œç¢ºèª
- [ ] README.mdã«ãƒãƒƒã‚¸è¿½åŠ 

---

**ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†æ—¥:** 2025-11-02  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼:** Phase 2å®Ÿè£…æ™‚  
**ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼:** junkei-okinawa

---

## ğŸŠ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼

CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

ã“ã‚Œã§ã€ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã³ã«è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã€
å“è³ªãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

è©³ç´°ã¯ [.github/CICD_README.md](./.github/CICD_README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
