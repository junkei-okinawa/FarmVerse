<!-- filepath: /workspaces/FarmVerse/docs/1_CultivationDiary/basic_design/11_ユーザー権限設計.md -->
# ユーザー・権限設計

## 1. ユーザー登録・認証方式
- **本サービスのMVPでは、パスワードをサービス側で保持しない認証方式を最優先とし、以下の順で導入を検討・実装します。**

### 優先度順の認証方式（日本の主要ユーザー層・ペルソナに最適化）
1. **LINE Login (OAuth/SSO)**
   - 日本国内で圧倒的な普及率。全年齢層・スマホユーザーに最適。
2. **Googleアカウントログイン (OAuth/SSO)**
   - Android・PCユーザーに広く普及。セキュリティ基盤も強固。
3. **Apple IDでサインイン (OAuth/SSO)**
   - iPhoneユーザーに最適。プライバシー保護機能も充実。
4. **メールアドレス + マジックリンク認証（パスワードレス）**
   - パスワード不要。メールのワンタイムURLで認証。

- **上記のいずれかで認証できない場合のみ、メールアドレス＋パスワード認証（強固なセキュリティ対策必須）を最終手段とします。**
- JWT認証を採用し、APIアクセス時の認可を実現。
- パスワードリセット（メール送信）機能は、パスワード認証を採用する場合のみ提供。
- その他の認証方式（SMS OTP、WebAuthn、生体認証、X(Twitter)ログイン、Facebookログイン、キャリアID連携等）は将来拡張として検討。

## 2. 権限レベル設計
| 権限区分       | 概要                         | 主な操作範囲                         |
|----------------|------------------------------|--------------------------------------|
| 一般ユーザー   | 通常の利用者                 | 自分の作物・記録・画像のCRUD         |
| 管理者         | サービス運営・管理者         | 全ユーザー・全データの管理（例：CRUD、不正利用監視、サポート対応、システム設定） |
| ゲスト         | 未登録ユーザー（将来拡張）   | 閲覧のみ（登録・編集不可）           |

- MVP段階では「一般ユーザー」「管理者」の2区分を実装。
- 将来的に「家族/グループ共有」や「ゲスト閲覧」も拡張可能な設計とする。

## 3. 権限ごとの操作範囲
- 一般ユーザー：
  - 自分が登録した作物・記録・画像・プロフィールの閲覧・編集・削除
  - 通知の受信・既読管理
- 管理者：
  - 全ユーザー・全データの管理（不正利用監視・サポート対応等）
  - システム設定や運用に関わる操作

## 4. ユーザー情報の管理
- プロフィール編集（ニックネーム、メール、**OAuth連携情報の管理**等）
- 退会（アカウント削除）機能（**ユーザーデータの完全削除を伴う方針**）
- プライバシーポリシー・利用規約への同意管理

## 5. セキュリティ・プライバシー配慮
- **認証情報**: MVPではサービス側でパスワードを直接保持しないことを原則とし、LINE/Google/Apple等のOAuth/SSOまたはマジックリンク認証を主軸とします。
- **パスワード認証を採用する場合**: 強力なハッシュ化（bcrypt, Argon2等）とソルトを用いた保存、総当たり攻撃対策、二要素認証（2FA）の提供、パスワードポリシー、アカウントロック、不審ログイン通知等を徹底。
- メール認証による本人確認（新規登録時など）
- APIアクセス時の認可チェック（JWTトークン）
- 個人情報・画像データの厳格なアクセス制御（FireStoreセキュリティルール、バックエンドAPI認可）

## 6. API・画面設計との関連
- 認証API：/api/auth/line, /api/auth/google, /api/auth/apple, /api/auth/magic-link, /api/auth/register, /api/auth/login, /api/auth/logout, /api/auth/password-reset
- ユーザーAPI：/api/users/{id}（GET/PUT/DELETE）
- 権限制御はAPI側（必須）とフロント側（UI制御）双方で実装
- 画面：LINE/Google/Appleログイン、マジックリンク送信、ログイン/新規登録、プロフィール編集、管理者用ダッシュボード

## 7. 将来拡張メモ
- 家族/グループ単位でのデータ共有（グループ権限）
- **SNSアカウント連携によるログイン（優先的に検討）**
- ゲスト閲覧モード
- 二要素認証（2FA）（パスワード認証を採用する場合に特に重要）

---

必要に応じてER図・画面遷移図・API詳細も追加可能。
